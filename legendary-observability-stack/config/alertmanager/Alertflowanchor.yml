# ğŸ””ğŸ’âš¡ LEGENDARY ALERTMANAGER CONFIGURATION âš¡ğŸ’ğŸ“
# ADHD-optimized alerting with intelligent noise reduction
# Integrates with Discord, email, and Memory Crystal systems

global:
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alerts@hyperfocuszone.com'
  smtp_auth_username: 'alerts@hyperfocuszone.com'
  smtp_auth_password: ''
  # ğŸ¯ ADHD-FRIENDLY: Longer resolve timeout to avoid alert spam
  resolve_timeout: 5m

# ğŸš€ NOTIFICATION TEMPLATES
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# ğŸ“¨ ROUTING CONFIGURATION
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 30s
  repeat_interval: 12h
  receiver: 'legendary-default'

  # ğŸ¯ PRIORITY ROUTING (ADHD-optimized)
  routes:
  # ğŸš¨ CRITICAL ALERTS - Immediate notification
  - match:
      severity: critical
    receiver: 'legendary-critical'
    group_wait: 10s
    group_interval: 5m
    repeat_interval: 30m

  # âš ï¸ WARNING ALERTS - Grouped to reduce noise
  - match:
      severity: warning
    receiver: 'legendary-warning'
    group_wait: 30s
    group_interval: 10m
    repeat_interval: 4h

  # ğŸ’ BROSKIE REWARDS - Special handling
  - match:
      alertname: BroskieRewardAlert
    receiver: 'broskie-celebration'
    group_wait: 5s
    repeat_interval: 24h

  # ğŸ§  MEMORY CRYSTAL ALERTS
  - match:
      service: memory-crystal
    receiver: 'memory-crystal-alerts'
    group_wait: 15s
    repeat_interval: 6h

  # ğŸ¥ HEALTH SERVICE ALERTS
  - match:
      job: legendary-health-service
    receiver: 'health-service-alerts'
    group_wait: 20s
    repeat_interval: 2h

# ğŸ“¢ RECEIVERS CONFIGURATION
receivers:
# ğŸ“ DEFAULT RECEIVER
- name: 'legendary-default'
  discord_configs:
  - webhook_url: 'DISCORD_WEBHOOK_URL_HERE'
    title: 'ğŸ¯ Legendary Empire Alert'
    message: |
      **Alert:** {{ .GroupLabels.alertname }}
      **Severity:** {{ .CommonLabels.severity }}
      **Service:** {{ .CommonLabels.job }}
      **Description:** {{ .CommonAnnotations.description }}
      **Time:** {{ .CommonAnnotations.timestamp }}

      ğŸ” **Details:** {{ .CommonAnnotations.summary }}

# ğŸš¨ CRITICAL ALERTS
- name: 'legendary-critical'
  discord_configs:
  - webhook_url: 'DISCORD_WEBHOOK_URL_HERE'
    title: 'ğŸš¨ CRITICAL EMPIRE ALERT ğŸš¨'
    message: |
      @everyone **CRITICAL SYSTEM ISSUE**

      ğŸ”¥ **Alert:** {{ .GroupLabels.alertname }}
      ğŸ¯ **Service:** {{ .CommonLabels.job }}
      â° **Time:** {{ .CommonAnnotations.timestamp }}

      ğŸ“‹ **Description:** {{ .CommonAnnotations.description }}
      ğŸ”§ **Resolution:** {{ .CommonAnnotations.resolution | default "Check system logs and restart if necessary" }}

      ğŸ† **Empire Status:** Requires immediate attention!
  email_configs:
  - to: 'admin@hyperfocuszone.com'
    subject: 'ğŸš¨ CRITICAL: {{ .GroupLabels.alertname }}'
    body: |
      Critical alert in Legendary Empire monitoring system.

      Alert: {{ .GroupLabels.alertname }}
      Service: {{ .CommonLabels.job }}
      Time: {{ .CommonAnnotations.timestamp }}

      Description: {{ .CommonAnnotations.description }}

# âš ï¸ WARNING ALERTS
- name: 'legendary-warning'
  discord_configs:
  - webhook_url: 'DISCORD_WEBHOOK_URL_HERE'
    title: 'âš ï¸ Empire Warning'
    message: |
      **Warning Alert**
      ğŸ¯ **Service:** {{ .CommonLabels.job }}
      ğŸ“Š **Metric:** {{ .GroupLabels.alertname }}
      ğŸ“ **Details:** {{ .CommonAnnotations.summary }}

# ğŸ’ BROSKIE CELEBRATION RECEIVER
- name: 'broskie-celebration'
  discord_configs:
  - webhook_url: 'DISCORD_WEBHOOK_URL_HERE'
    title: 'ğŸ’ BROski$ Reward Alert!'
    message: |
      ğŸ‰ **LEGENDARY ACHIEVEMENT UNLOCKED!** ğŸ‰

      ğŸ’° **Reward:** {{ .CommonAnnotations.broskie_amount | default "1000" }} BROski$
      ğŸ† **Achievement:** {{ .CommonAnnotations.achievement_name }}
      âš¡ **Service:** {{ .CommonLabels.job }}

      ğŸš€ **Keep up the legendary work!** ğŸ’

# ğŸ§  MEMORY CRYSTAL ALERTS
- name: 'memory-crystal-alerts'
  discord_configs:
  - webhook_url: 'DISCORD_WEBHOOK_URL_HERE'
    title: 'ğŸ§  Memory Crystal System Alert'
    message: |
      **Memory Crystal Event**
      ğŸ’ **Crystal ID:** {{ .CommonLabels.crystal_id | default "Unknown" }}
      ğŸ“Š **Event:** {{ .GroupLabels.alertname }}
      ğŸ” **Details:** {{ .CommonAnnotations.description }}

# ğŸ¥ HEALTH SERVICE ALERTS
- name: 'health-service-alerts'
  discord_configs:
  - webhook_url: 'DISCORD_WEBHOOK_URL_HERE'
    title: 'ğŸ¥ Health Service Alert'
    message: |
      **System Health Event**
      ğŸ“Š **Health Score:** {{ .CommonAnnotations.health_score | default "Unknown" }}%
      ğŸ¯ **Component:** {{ .CommonLabels.component | default .GroupLabels.alertname }}
      ğŸ“ **Status:** {{ .CommonAnnotations.summary }}

# ğŸ”‡ INHIBITION RULES (Noise Reduction)
inhibit_rules:
# High priority alerts silence lower priority ones
- source_match:
    severity: 'critical'
  target_match:
    severity: 'warning'
  equal: ['alertname', 'cluster', 'service']

# Service down silences other alerts for that service
- source_match:
    alertname: 'ServiceDown'
  target_match_re:
    service: '.*'
  equal: ['service']

# Memory Crystal system down silences crystal-specific alerts
- source_match:
    alertname: 'MemoryCrystalSystemDown'
  target_match:
    service: 'memory-crystal'
  equal: ['service']
